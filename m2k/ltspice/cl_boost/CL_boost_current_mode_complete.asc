Version 4
SHEET 1 5968 2596
WIRE 1104 352 1056 352
WIRE 1136 352 1104 352
WIRE 1168 352 1136 352
WIRE 1424 352 1360 352
WIRE 1456 352 1424 352
WIRE 2896 384 2864 384
WIRE 2928 384 2896 384
WIRE 2960 384 2928 384
WIRE 3184 384 3152 384
WIRE 1104 400 1104 352
WIRE 1136 400 1136 352
WIRE 1168 400 1168 352
WIRE 1360 400 1360 352
WIRE 2896 432 2896 384
WIRE 2928 432 2928 384
WIRE 2960 432 2960 384
WIRE 3152 432 3152 384
WIRE 1360 672 1360 656
WIRE 1104 688 1104 656
WIRE 1136 688 1136 656
WIRE 1136 688 1104 688
WIRE 1168 688 1168 656
WIRE 1168 688 1136 688
WIRE 3152 704 3152 688
WIRE 1488 736 1248 736
WIRE 2896 736 2896 688
WIRE 2896 736 2752 736
WIRE 2928 736 2928 688
WIRE 2928 736 2896 736
WIRE 2960 736 2960 688
WIRE 2960 736 2928 736
WIRE 1488 752 1488 736
WIRE 1488 752 1392 752
WIRE 1056 768 1056 352
WIRE 1216 768 1056 768
WIRE 352 816 272 816
WIRE 1072 880 1024 880
WIRE 1104 880 1104 688
WIRE 1104 880 1072 880
WIRE 1120 880 1104 880
WIRE 1216 880 1216 768
WIRE 1216 880 1200 880
WIRE 1248 880 1248 736
WIRE 1248 880 1216 880
WIRE 1264 880 1248 880
WIRE 1392 880 1392 752
WIRE 1392 880 1360 880
WIRE 1424 880 1392 880
WIRE 2208 880 1424 880
WIRE 2368 880 2208 880
WIRE 2624 880 2448 880
WIRE 2656 880 2624 880
WIRE 2752 880 2752 736
WIRE 2752 880 2720 880
WIRE 2768 880 2752 880
WIRE 2864 880 2864 384
WIRE 2864 880 2848 880
WIRE 3008 880 2864 880
WIRE 3136 880 3008 880
WIRE 3264 880 3136 880
WIRE 3376 880 3264 880
WIRE 3264 896 3264 880
WIRE 3376 896 3376 880
WIRE 3488 896 3488 880
WIRE 3584 896 3584 880
WIRE 3696 896 3696 880
WIRE 2208 928 2208 880
WIRE 1344 944 1344 928
WIRE 1344 944 1264 944
WIRE 1424 944 1424 880
WIRE 3008 960 3008 880
WIRE 3136 960 3136 880
WIRE 1072 976 1072 880
WIRE 1136 976 1072 976
WIRE 1264 976 1264 944
WIRE 1264 976 1216 976
WIRE 1344 976 1344 944
WIRE 3584 976 3488 976
WIRE 3696 976 3584 976
WIRE 3264 992 3264 960
WIRE 3376 992 3376 976
WIRE -128 1008 -256 1008
WIRE 32 1008 -64 1008
WIRE 3488 1008 3488 976
WIRE 2624 1024 2624 880
WIRE 2208 1040 2208 992
WIRE 352 1088 352 816
WIRE 480 1088 352 1088
WIRE 3008 1088 3008 1040
WIRE 3008 1088 2944 1088
WIRE 3072 1088 3040 1088
WIRE 3136 1088 3136 1040
WIRE 3136 1088 3072 1088
WIRE -256 1104 -256 1008
WIRE -208 1104 -256 1104
WIRE -80 1104 -128 1104
WIRE 32 1104 32 1008
WIRE 32 1104 -16 1104
WIRE 3008 1104 3008 1088
WIRE 3136 1104 3136 1088
WIRE 1696 1120 1696 1088
WIRE 1872 1120 1696 1120
WIRE 2144 1120 1936 1120
WIRE 752 1136 432 1136
WIRE 432 1184 432 1136
WIRE 480 1184 432 1184
WIRE 1696 1200 1696 1120
WIRE 1744 1200 1696 1200
WIRE 2144 1200 2144 1120
WIRE 2144 1200 2032 1200
WIRE 3008 1200 3008 1184
WIRE 3136 1200 3136 1184
WIRE 1056 1216 976 1216
WIRE 1408 1216 1312 1216
WIRE 1488 1216 1408 1216
WIRE 1568 1232 1568 1184
WIRE 1568 1232 1520 1232
WIRE -448 1248 -720 1248
WIRE -336 1248 -368 1248
WIRE -144 1248 -144 1216
WIRE -336 1264 -336 1248
WIRE -256 1264 -256 1104
WIRE -256 1264 -336 1264
WIRE -208 1264 -256 1264
WIRE -176 1264 -208 1264
WIRE 1568 1264 1568 1232
WIRE 1584 1264 1568 1264
WIRE 2624 1264 2624 1024
WIRE 32 1280 32 1104
WIRE 32 1280 -112 1280
WIRE 256 1280 32 1280
WIRE 320 1280 256 1280
WIRE 432 1280 432 1184
WIRE 432 1280 320 1280
WIRE 752 1280 752 1136
WIRE 1056 1280 752 1280
WIRE 1408 1280 1312 1280
WIRE 1584 1280 1408 1280
WIRE 1744 1280 1648 1280
WIRE 2112 1280 2032 1280
WIRE -176 1296 -592 1296
WIRE 1568 1296 1568 1264
WIRE 1584 1296 1568 1296
WIRE 2240 1296 2208 1296
WIRE 1520 1312 1520 1232
WIRE 1584 1312 1520 1312
WIRE -144 1328 -144 1312
WIRE 0 1328 -144 1328
WIRE 320 1328 320 1280
WIRE 1568 1328 1568 1296
WIRE 1584 1328 1568 1328
WIRE 1056 1344 464 1344
WIRE 1344 1344 1312 1344
WIRE 2112 1344 2112 1280
WIRE 2208 1344 2112 1344
WIRE 2544 1344 2448 1344
WIRE 2576 1344 2544 1344
WIRE -240 1360 -352 1360
WIRE -96 1360 -240 1360
WIRE 1600 1360 1600 1328
WIRE 1744 1360 1696 1360
WIRE 2112 1360 2112 1344
WIRE 2112 1360 2032 1360
WIRE 2144 1376 2144 1200
WIRE -352 1392 -352 1360
WIRE 2208 1392 2208 1344
WIRE 2240 1392 2208 1392
WIRE 1056 1408 1024 1408
WIRE 1376 1408 1312 1408
WIRE 1392 1408 1376 1408
WIRE 1488 1408 1488 1216
WIRE 1488 1408 1472 1408
WIRE 2624 1408 2624 1360
WIRE 2624 1408 2448 1408
WIRE -96 1424 -240 1424
WIRE 0 1424 0 1328
WIRE 0 1424 -96 1424
WIRE 320 1424 320 1392
WIRE 1696 1440 1696 1360
WIRE 1744 1440 1696 1440
WIRE 2144 1440 2032 1440
WIRE 2624 1456 2624 1408
WIRE 1376 1472 1376 1408
WIRE 1536 1472 1376 1472
WIRE 1648 1472 1536 1472
WIRE -240 1488 -240 1424
WIRE 624 1488 576 1488
WIRE 1024 1488 1024 1408
WIRE 1344 1488 1344 1344
WIRE 1344 1488 1024 1488
WIRE 1696 1504 1696 1440
WIRE 1888 1504 1888 1488
WIRE 1888 1504 1696 1504
WIRE 2240 1504 2208 1504
WIRE 320 1520 320 1488
WIRE 1696 1520 1696 1504
WIRE 464 1536 464 1344
WIRE 576 1536 464 1536
WIRE 1344 1552 1344 1488
WIRE 2144 1552 2144 1440
WIRE 2208 1552 2144 1552
WIRE -96 1568 -240 1568
WIRE 576 1584 576 1536
WIRE 624 1584 576 1584
WIRE -288 1600 -352 1600
WIRE 2208 1600 2208 1552
WIRE 2240 1600 2208 1600
WIRE 2544 1600 2544 1344
WIRE 2624 1600 2624 1536
WIRE 1520 1616 1344 1616
WIRE -720 1648 -720 1248
WIRE -352 1648 -352 1600
WIRE -352 1648 -720 1648
WIRE -304 1696 -352 1696
WIRE 2544 1744 2544 1680
WIRE 1648 1760 1648 1472
WIRE -160 1808 -240 1808
WIRE 1488 1824 1488 1744
WIRE 1504 1824 1488 1824
WIRE 1312 1840 1264 1840
WIRE 1344 1840 1344 1616
WIRE 1344 1840 1312 1840
WIRE 1504 1840 1344 1840
WIRE 1600 1840 1568 1840
WIRE 1488 1856 1488 1824
WIRE 1504 1856 1488 1856
WIRE 1312 1872 1312 1840
WIRE 1344 1872 1312 1872
WIRE 1424 1872 1408 1872
WIRE 1504 1872 1424 1872
WIRE 1584 1872 1568 1872
WIRE 1488 1888 1488 1856
WIRE 1504 1888 1488 1888
WIRE 2608 1888 2608 1840
WIRE 1424 1904 1424 1872
WIRE -160 1920 -160 1888
WIRE -64 1920 -160 1920
WIRE 192 1920 96 1920
WIRE 240 1920 192 1920
WIRE 608 1920 384 1920
WIRE 1152 1920 832 1920
WIRE 1520 1920 1520 1888
WIRE 2432 1920 2352 1920
WIRE -160 1952 -160 1920
WIRE 192 1968 192 1920
WIRE 384 1968 384 1920
WIRE 384 1968 192 1968
WIRE 608 2000 592 2000
WIRE 880 2000 832 2000
WIRE 1008 2000 880 2000
WIRE 1424 2000 1424 1984
WIRE 2352 2000 2352 1920
WIRE 240 2016 192 2016
WIRE 880 2016 880 2000
WIRE 1008 2016 1008 2000
WIRE 2608 2016 2608 1968
WIRE 2608 2016 2496 2016
WIRE 1648 2032 1648 1856
WIRE 2960 2032 2960 2016
WIRE 96 2064 96 1920
WIRE 2496 2064 2496 2016
WIRE 2608 2064 2608 2016
WIRE 608 2080 544 2080
WIRE 848 2080 832 2080
WIRE 2160 2080 2160 2064
WIRE 544 2096 544 2080
WIRE 848 2112 848 2080
WIRE 880 2112 880 2096
WIRE 880 2112 848 2112
WIRE 1008 2112 1008 2096
WIRE 880 2128 880 2112
WIRE 2352 2128 2352 2080
WIRE 2960 2128 2960 2112
WIRE 2160 2176 2160 2160
WIRE 544 2192 544 2176
WIRE 2608 2208 2608 2144
WIRE 880 2224 880 2208
FLAG 3376 880 OUT
FLAG 3136 1200 0
FLAG 3264 992 0
FLAG 3376 992 0
FLAG 2352 2128 0
FLAG 2960 2128 0
FLAG 2960 2016 IN
FLAG 2624 1600 0
FLAG 3072 1088 Vfb12
FLAG 2208 1040 0
FLAG 2496 2064 0
FLAG 1360 672 0
FLAG 2608 2208 Vm
FLAG 3072 688 Vm
FLAG 2608 1840 Vp
FLAG 3072 432 Vp
FLAG 1280 400 Vp
FLAG 1280 656 Vm
FLAG 1424 352 Ihigh
FLAG 3152 704 0
FLAG 2624 1024 bswitch
FLAG 3008 1200 0
FLAG 2944 1088 Vfb5
FLAG 3184 384 Ilow
FLAG 1344 1552 0
FLAG 1648 2032 0
FLAG 624 1584 Ihigh
FLAG 624 1488 Ilow
FLAG 1264 1840 clk
FLAG 1520 1920 0
FLAG 1488 1744 Vcc
FLAG 1424 2000 0
FLAG 2544 1744 0
FLAG 976 1216 Vcc
FLAG 1696 1088 Vcc
FLAG 2240 1296 tgate
FLAG 2448 1344 bgate
FLAG 2240 1504 tsource
FLAG 2240 1600 bsource
FLAG 1344 976 tgate
FLAG 1424 944 tsource
FLAG 2240 1392 bgate
FLAG 2448 1408 bsource
FLAG 2816 1968 0
FLAG 2816 1888 Vcc
FLAG 1696 1520 0
FLAG 1024 880 IN
FLAG 256 1280 Vt
FLAG -304 1696 Vfb5
FLAG -288 1600 Vfb12
FLAG -592 1296 V1.24
FLAG -144 1216 Vcc
FLAG -352 1392 0
FLAG -96 1568 Vm
FLAG -208 1264 Vsame
FLAG 3488 1008 0
FLAG 1008 2112 0
FLAG 592 2000 0
FLAG 544 2192 0
FLAG 880 2224 0
FLAG 1152 1920 clk
FLAG -64 1920 Vmod1
FLAG 2160 2176 0
FLAG 2160 2064 V1.24
FLAG -160 2032 0
FLAG -240 1808 V1.24
FLAG 480 1184 VoltageMode
FLAG 480 1088 Manualmode
FLAG 272 896 0
FLAG 240 2016 VoltageModeDuty
FLAG 240 1920 ManualDuty
FLAG 1600 1360 0
FLAG 1568 1184 Vcc
FLAG 96 2144 0
FLAG 1408 1280 q
FLAG 1408 1216 qnot
FLAG 1536 1472 le
FLAG 320 1520 0
SYMBOL ind 2352 896 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 100µ
SYMATTR SpiceLine Rser=0.02 Rpar=5000
SYMBOL schottky 2656 896 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value MBRS340
SYMBOL RES 3120 944 R0
SYMATTR InstName R1
SYMATTR Value 10.7K
SYMBOL RES 3120 1088 R0
SYMATTR InstName R2
SYMATTR Value 1.24K
SYMBOL polcap 3248 896 R0
SYMATTR InstName C1
SYMATTR Value 150µ
SYMATTR SpiceLine Rser=15m
SYMBOL VOLTAGE 2960 2016 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value 5
SYMBOL res 3360 880 R0
SYMATTR InstName Rload
SYMATTR Value 100
SYMBOL res 2608 1440 R0
SYMATTR InstName R4
SYMATTR Value 1m
SYMBOL VOLTAGE 2352 1984 R0
WINDOW 3 -190 -68 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value SINE(.25 .1 50)
SYMATTR InstName V3
SYMBOL schottky 2224 992 R180
WINDOW 0 24 64 Left 2
WINDOW 3 -116 34 Left 2
SYMATTR InstName D2
SYMATTR Value MBRS340
SYMBOL res 1216 864 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 0.1
SYMBOL Opamps\\LT1995 3072 560 R0
SYMATTR InstName U1
SYMBOL Opamps\\LT1995 1280 528 R0
SYMATTR InstName U3
SYMBOL VOLTAGE 2608 2048 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V4
SYMATTR Value 10
SYMBOL VOLTAGE 2608 1872 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V5
SYMATTR Value 15
SYMBOL nmos 2576 1264 R0
SYMATTR InstName M1
SYMATTR Value Si4896DY
SYMBOL res 2864 864 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 0.1
SYMBOL res 1232 960 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL RES 2992 944 R0
SYMATTR InstName R9
SYMATTR Value 3.76K
SYMBOL RES 2992 1088 R0
SYMATTR InstName R10
SYMATTR Value 1.24K
SYMBOL res 2528 1584 R0
WINDOW 0 -42 15 Left 2
WINDOW 3 -46 65 Left 2
SYMATTR InstName R16
SYMATTR Value 10k
SYMBOL Comparators\\LT1671 1184 1312 R0
SYMATTR InstName U4
SYMBOL res 1376 1392 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 2k
SYMBOL nmos 1600 1760 R0
SYMATTR InstName M3
SYMATTR Value 2N7002
SYMBOL Digital\\and 1536 1792 R0
SYMATTR InstName A1
SYMATTR Value2 Vhigh=5 Ref=2.5 td=5ns
SYMBOL res 1408 1888 R0
SYMATTR InstName R15
SYMATTR Value 1k
SYMBOL cap 1408 1856 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 220p
SYMBOL nmos 1264 928 R270
SYMATTR InstName M4
SYMATTR Value Si4896DY
SYMBOL voltage 2816 1872 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value 5
SYMBOL cap 2128 1376 R0
SYMATTR InstName C4
SYMATTR Value 0.1µ
SYMBOL diode 1872 1136 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL res -112 1088 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL cap -16 1088 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 100n
SYMBOL res -352 1232 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 1k
SYMBOL Opamps\\LT6015 -144 1280 R0
SYMATTR InstName U2
SYMBOL schottky -256 1360 R0
SYMATTR InstName D4
SYMATTR Value MBRS340
SYMBOL cap -112 1360 R0
SYMATTR InstName C5
SYMATTR Value 5µ
SYMBOL res -256 1472 R0
SYMATTR InstName R3
SYMATTR Value 100k
SYMBOL res 3472 880 R0
SYMATTR InstName R18
SYMATTR Value 100
SYMBOL res 3568 880 R0
SYMATTR InstName R19
SYMATTR Value 50
SYMBOL res 3680 880 R0
SYMATTR InstName R21
SYMATTR Value 50
SYMBOL res 864 2000 R0
SYMATTR InstName R24
SYMATTR Value 976k
SYMBOL res 864 2112 R0
SYMATTR InstName R25
SYMATTR Value 182k
SYMBOL res 528 2080 R0
SYMATTR InstName R26
SYMATTR Value 62.6k
SYMBOL voltage 1008 2000 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V8
SYMATTR Value 5
SYMBOL SpecialFunctions\\LTC6992-1 720 2000 R0
SYMATTR InstName U7
SYMBOL voltage 2160 2064 R0
SYMATTR InstName V2
SYMATTR Value 1.24
SYMBOL res -176 1792 R0
SYMATTR InstName R17
SYMATTR Value 14.9k
SYMBOL res -176 1936 R0
SYMATTR InstName R22
SYMATTR Value 10k
SYMBOL voltage 272 800 R0
SYMATTR InstName V6
SYMATTR Value 600mV
SYMBOL Digital\\and 1616 1232 R0
SYMATTR InstName A2
SYMATTR Value2 Vhigh=5 Ref=2.5 td=5ns
SYMBOL voltage 96 2048 R0
SYMATTR InstName V9
SYMATTR Value 600m
SYMBOL diode 304 1328 R0
SYMATTR InstName D5
SYMATTR Value 1N4148
SYMBOL diode 304 1424 R0
SYMATTR InstName D6
SYMATTR Value 1N4148
SYMBOL PowerProducts\\LTC7001 1888 1328 R0
SYMATTR InstName U5
TEXT 2712 1688 Left 2 !.tran 0 5.2m 0 10n startup
TEXT 2720 1736 Left 2 !.model my_sw sw(Vt= 0.5 Vh=-.25 Ron=0.01 Roff=100Meg)
TEXT 2736 1464 Left 2 ;Usual location for boost sense\nresistor, but since we've got a \nhigh-side sense amplifier, we\nmight as well use it.
TEXT 1536 728 Left 2 ;MUST be shorted\nin BOOST mode,\ncut link in BUCK mode
TEXT 1096 304 Left 2 ;"Poor man's current probe"
TEXT 2880 344 Left 2 ;"Poor man's current probe"
TEXT 2552 792 Left 2 ;(Can be shorted\nin Buck mode)
TEXT 2016 952 Left 2 ;(Can be open\nin Boost mode)
TEXT 608 1608 Left 2 ;MUST Connect for Boost\nalso works for buck
TEXT 616 1456 Left 2 ;Optional for Boost
TEXT 1536 2112 Left 2 ;Positive edge detector - \nSet pulse needs to be a sliver
TEXT 2712 2080 Left 2 ;TGate pulled high\nin boost mode
TEXT 1480 2184 Left 2 ;74HC03 is exactly the right part\n(NAND w/ Open Drain outputs)
TEXT 1120 1152 Left 2 ;Comparator
TEXT 1792 1512 Left 2 ;Gate Driver
TEXT 2248 1848 Left 2 ;Sine stimulus for\nAC analysis
TEXT 1856 1680 Left 2 ;tgate and tsource connected for Buck mode\nbgate and bsource connected for Boost mode
TEXT 2120 2264 Left 2 ;Voltage sources
TEXT 776 744 Left 2 ;Gain of 7 \nProportion of 0.7V =1A
TEXT 2560 656 Left 2 ;Gain of 7 \nProportion of 0.7V =1A
TEXT -872 1680 Left 2 ;feedback voltage for output voltages
TEXT 3312 808 Left 2 ;.step param R 12.5 100 20
TEXT 1960 688 Left 7 ;BOOST
TEXT 576 1808 Left 2 ;fout = (1MHz * 50k) / (N * Rset)\nRset = (1MHz * 50k) / (N * fout)
TEXT 648 2144 Left 2 ;Master Clock
TEXT 448 1736 Left 2 ;duty = Vmod-0.1/0.8
TEXT 240 752 Left 2 ;Potentiometer
TEXT -168 1760 Left 2 ;Potentiometer
TEXT 1984 760 Left 4 ;Current mode
RECTANGLE Normal 3088 2288 2064 1792 2
CIRCLE Normal 592 1600 560 1568
CIRCLE Normal 592 1504 560 1472
CIRCLE Normal 592 1552 560 1520
CIRCLE Normal 2224 1408 2192 1376
CIRCLE Normal 2224 1312 2192 1280
CIRCLE Normal 2224 1360 2192 1328
CIRCLE Normal 2224 1616 2192 1584
CIRCLE Normal 2224 1520 2192 1488
CIRCLE Normal 2224 1568 2192 1536
CIRCLE Normal -336 1712 -368 1680
CIRCLE Normal -336 1616 -368 1584
CIRCLE Normal -336 1664 -368 1632
CIRCLE Normal 448 1200 416 1168
CIRCLE Normal 448 1104 416 1072
CIRCLE Normal 448 1152 416 1120
CIRCLE Normal 208 2032 176 2000
CIRCLE Normal 208 1936 176 1904
CIRCLE Normal 208 1984 176 1952
