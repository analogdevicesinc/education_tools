Version 4
SHEET 1 5968 2596
WIRE 1104 352 1056 352
WIRE 1136 352 1104 352
WIRE 1168 352 1136 352
WIRE 1424 352 1360 352
WIRE 1456 352 1424 352
WIRE 2896 384 2864 384
WIRE 2928 384 2896 384
WIRE 2960 384 2928 384
WIRE 3184 384 3152 384
WIRE 1104 400 1104 352
WIRE 1136 400 1136 352
WIRE 1168 400 1168 352
WIRE 1360 400 1360 352
WIRE 2896 432 2896 384
WIRE 2928 432 2928 384
WIRE 2960 432 2960 384
WIRE 3152 432 3152 384
WIRE 1360 672 1360 656
WIRE 1104 688 1104 656
WIRE 1136 688 1136 656
WIRE 1136 688 1104 688
WIRE 1168 688 1168 656
WIRE 1168 688 1136 688
WIRE 3152 704 3152 688
WIRE 2896 736 2896 688
WIRE 2896 736 2752 736
WIRE 2928 736 2928 688
WIRE 2928 736 2896 736
WIRE 2960 736 2960 688
WIRE 2960 736 2928 736
WIRE 1488 752 1488 736
WIRE 1488 752 1392 752
WIRE 1056 768 1056 352
WIRE 1216 768 1056 768
WIRE 272 816 192 816
WIRE 1072 880 1024 880
WIRE 1104 880 1104 688
WIRE 1104 880 1072 880
WIRE 1120 880 1104 880
WIRE 1216 880 1216 768
WIRE 1216 880 1200 880
WIRE 1248 880 1248 736
WIRE 1248 880 1216 880
WIRE 1264 880 1248 880
WIRE 1392 880 1392 752
WIRE 1392 880 1360 880
WIRE 1424 880 1392 880
WIRE 2208 880 1424 880
WIRE 2368 880 2208 880
WIRE 2624 880 2448 880
WIRE 2656 880 2624 880
WIRE 2752 880 2752 736
WIRE 2752 880 2720 880
WIRE 2768 880 2752 880
WIRE 2864 880 2864 384
WIRE 2864 880 2848 880
WIRE 3008 880 2864 880
WIRE 3136 880 3008 880
WIRE 3264 880 3136 880
WIRE 3376 880 3264 880
WIRE 3520 880 3376 880
WIRE 3648 880 3520 880
WIRE 3776 880 3648 880
WIRE 3264 896 3264 880
WIRE 3376 896 3376 880
WIRE 3520 896 3520 880
WIRE 3648 896 3648 880
WIRE 3776 896 3776 880
WIRE 2208 928 2208 880
WIRE 1344 944 1344 928
WIRE 1344 944 1264 944
WIRE 1424 944 1424 880
WIRE 3008 960 3008 880
WIRE 3136 960 3136 880
WIRE 1072 976 1072 880
WIRE 1136 976 1072 976
WIRE 1264 976 1216 976
WIRE 1344 976 1344 944
WIRE 3520 976 3376 976
WIRE 3648 976 3520 976
WIRE 3776 976 3648 976
WIRE 3264 992 3264 960
WIRE 32 1008 -64 1008
WIRE 2624 1024 2624 880
WIRE 3376 1024 3376 976
WIRE 2208 1040 2208 992
WIRE 272 1088 272 816
WIRE 352 1088 272 1088
WIRE 400 1088 352 1088
WIRE 3008 1088 3008 1040
WIRE 3008 1088 2944 1088
WIRE 3072 1088 3040 1088
WIRE 3136 1088 3136 1040
WIRE 3136 1088 3072 1088
WIRE -256 1104 -256 1008
WIRE -208 1104 -256 1104
WIRE -64 1104 -128 1104
WIRE 32 1104 32 1008
WIRE 32 1104 0 1104
WIRE 3008 1104 3008 1088
WIRE 3136 1104 3136 1088
WIRE 1680 1120 1680 1088
WIRE 1856 1120 1680 1120
WIRE 2144 1120 1920 1120
WIRE 352 1136 352 1088
WIRE 672 1136 352 1136
WIRE 400 1184 352 1184
WIRE 1680 1200 1680 1120
WIRE 1728 1200 1680 1200
WIRE 2144 1200 2144 1120
WIRE 2144 1200 2016 1200
WIRE 3008 1200 3008 1184
WIRE 3136 1200 3136 1184
WIRE 1056 1216 976 1216
WIRE 1488 1216 1312 1216
WIRE 1568 1232 1568 1184
WIRE 1568 1232 1520 1232
WIRE -480 1248 -720 1248
WIRE -336 1248 -400 1248
WIRE -144 1248 -144 1216
WIRE -336 1264 -336 1248
WIRE -256 1264 -256 1104
WIRE -256 1264 -336 1264
WIRE -176 1264 -256 1264
WIRE 1568 1264 1568 1232
WIRE 1584 1264 1568 1264
WIRE 2624 1264 2624 1024
WIRE 32 1280 32 1104
WIRE 32 1280 -112 1280
WIRE 128 1280 32 1280
WIRE 176 1280 128 1280
WIRE 304 1280 176 1280
WIRE 352 1280 304 1280
WIRE 672 1280 672 1136
WIRE 1056 1280 672 1280
WIRE 1360 1280 1312 1280
WIRE 1584 1280 1440 1280
WIRE 1728 1280 1648 1280
WIRE 2112 1280 2096 1280
WIRE -176 1296 -592 1296
WIRE 1568 1296 1568 1264
WIRE 1584 1296 1568 1296
WIRE 2240 1296 2208 1296
WIRE 304 1312 304 1280
WIRE 1584 1312 1520 1312
WIRE 1664 1312 1648 1312
WIRE -144 1328 -144 1312
WIRE 0 1328 -144 1328
WIRE 1568 1328 1568 1296
WIRE 1584 1328 1568 1328
WIRE 1056 1344 464 1344
WIRE 1344 1344 1312 1344
WIRE 2112 1344 2112 1280
WIRE 2208 1344 2208 1296
WIRE 2208 1344 2112 1344
WIRE 2544 1344 2448 1344
WIRE 2576 1344 2544 1344
WIRE -240 1360 -352 1360
WIRE -96 1360 -240 1360
WIRE 1600 1360 1600 1328
WIRE 1728 1360 1680 1360
WIRE 2112 1360 2112 1344
WIRE 2112 1360 2096 1360
WIRE 2144 1376 2144 1200
WIRE -352 1392 -352 1360
WIRE 2240 1392 2208 1392
WIRE 304 1408 304 1376
WIRE 1056 1408 1024 1408
WIRE 1376 1408 1312 1408
WIRE 1392 1408 1376 1408
WIRE 1488 1408 1488 1216
WIRE 1488 1408 1472 1408
WIRE 2624 1408 2624 1360
WIRE 2624 1408 2448 1408
WIRE -96 1424 -240 1424
WIRE 0 1424 0 1328
WIRE 0 1424 -96 1424
WIRE 1680 1440 1680 1360
WIRE 1728 1440 1680 1440
WIRE 2144 1440 2016 1440
WIRE 2624 1456 2624 1408
WIRE 1376 1472 1376 1408
WIRE 1648 1472 1376 1472
WIRE -240 1488 -240 1424
WIRE 304 1488 304 1472
WIRE 624 1488 576 1488
WIRE 1024 1488 1024 1408
WIRE 1344 1488 1344 1344
WIRE 1344 1488 1024 1488
WIRE 1680 1504 1680 1440
WIRE 1872 1504 1872 1488
WIRE 1872 1504 1680 1504
WIRE 2240 1504 2208 1504
WIRE 1680 1520 1680 1504
WIRE 464 1536 464 1344
WIRE 576 1536 464 1536
WIRE 1344 1552 1344 1488
WIRE 2144 1552 2144 1440
WIRE 2208 1552 2208 1504
WIRE 2208 1552 2144 1552
WIRE -96 1568 -240 1568
WIRE 576 1584 576 1536
WIRE 624 1584 576 1584
WIRE -288 1600 -352 1600
WIRE 2240 1600 2208 1600
WIRE 2544 1600 2544 1344
WIRE 2624 1600 2624 1536
WIRE -720 1648 -720 1248
WIRE -352 1648 -720 1648
WIRE 1520 1648 1520 1312
WIRE 1520 1648 1264 1648
WIRE -352 1696 -352 1648
WIRE -304 1696 -352 1696
WIRE 2544 1744 2544 1680
WIRE 1648 1760 1648 1472
WIRE 1488 1824 1488 1744
WIRE 1504 1824 1488 1824
WIRE -336 1840 -416 1840
WIRE 1264 1840 1264 1648
WIRE 1312 1840 1264 1840
WIRE 1504 1840 1312 1840
WIRE 1600 1840 1568 1840
WIRE 1488 1856 1488 1824
WIRE 1504 1856 1488 1856
WIRE 1312 1872 1312 1840
WIRE 1344 1872 1312 1872
WIRE 1424 1872 1408 1872
WIRE 1504 1872 1424 1872
WIRE 1584 1872 1568 1872
WIRE 1488 1888 1488 1856
WIRE 1504 1888 1488 1888
WIRE 1648 1888 1648 1856
WIRE 2608 1888 2608 1840
WIRE 128 1904 128 1280
WIRE 208 1904 128 1904
WIRE 256 1904 208 1904
WIRE 1424 1904 1424 1872
WIRE 1520 1920 1520 1888
WIRE 2432 1920 2352 1920
WIRE -336 1952 -336 1920
WIRE -240 1952 -336 1952
WIRE 64 1952 -240 1952
WIRE 208 1952 208 1904
WIRE 480 1952 208 1952
WIRE 1024 1952 704 1952
WIRE -336 1984 -336 1952
WIRE 64 2000 64 1952
WIRE 256 2000 64 2000
WIRE 1424 2000 1424 1984
WIRE 2352 2000 2352 1920
WIRE 2608 2016 2608 1968
WIRE 2608 2016 2496 2016
WIRE 480 2032 464 2032
WIRE 752 2032 704 2032
WIRE 880 2032 752 2032
WIRE 2960 2032 2960 2016
WIRE 752 2048 752 2032
WIRE 880 2048 880 2032
WIRE 2496 2064 2496 2016
WIRE 2608 2064 2608 2016
WIRE 480 2112 416 2112
WIRE 720 2112 704 2112
WIRE 416 2128 416 2112
WIRE 2352 2128 2352 2080
WIRE 2960 2128 2960 2112
WIRE 720 2144 720 2112
WIRE 752 2144 752 2128
WIRE 752 2144 720 2144
WIRE 880 2144 880 2128
WIRE 2176 2144 2176 2128
WIRE 752 2160 752 2144
WIRE 2608 2208 2608 2144
WIRE 416 2224 416 2208
WIRE 2176 2240 2176 2224
WIRE 752 2256 752 2240
FLAG 3376 880 OUT
FLAG 3136 1200 0
FLAG 3264 992 0
FLAG 3376 1024 0
FLAG 2352 2128 0
FLAG 2960 2128 0
FLAG 2960 2016 IN
FLAG 2624 1600 0
FLAG 3072 1088 Vfb12
FLAG 2208 1040 0
FLAG 2496 2064 0
FLAG 1360 672 0
FLAG 2608 2208 Vm
FLAG 3072 688 Vm
FLAG 2608 1840 Vp
FLAG 3072 432 Vp
FLAG 1280 400 Vp
FLAG 1280 656 Vm
FLAG 1424 352 Ihigh
FLAG 3152 704 0
FLAG 2624 1024 bswitch
FLAG 3008 1200 0
FLAG 2944 1088 Vfb5
FLAG 3184 384 Ilow
FLAG 1344 1552 0
FLAG 1648 1888 0
FLAG 624 1584 Ihigh
FLAG 624 1488 Ilow
FLAG 1264 1840 clk
FLAG 1520 1920 0
FLAG 1488 1744 Vcc
FLAG 1424 2000 0
FLAG 2544 1744 0
FLAG 976 1216 Vcc
FLAG 1680 1088 Vcc
FLAG 2240 1296 tgate
FLAG 2448 1344 bgate
FLAG 2240 1504 tsource
FLAG 2240 1600 bsource
FLAG 1344 976 tgate
FLAG 1424 944 tsource
FLAG 2240 1392 bgate
FLAG 2448 1408 bsource
FLAG 2816 1968 0
FLAG 2816 1888 Vcc
FLAG 1680 1520 0
FLAG 1024 880 IN
FLAG -304 1696 Vfb5
FLAG -288 1600 Vfb12
FLAG -592 1296 V1.24
FLAG -144 1216 Vcc
FLAG -352 1392 0
FLAG -96 1568 Vm
FLAG 880 2144 0
FLAG 464 2032 0
FLAG 416 2224 0
FLAG 752 2256 0
FLAG 1024 1952 clk
FLAG 2176 2240 0
FLAG 2176 2128 V1.24
FLAG 176 1280 Vt
FLAG 400 1088 Manualmode
FLAG 192 896 0
FLAG -240 1952 Vmod1
FLAG -336 2064 0
FLAG -416 1840 V1.24
FLAG 256 1904 Vt
FLAG 256 2000 ManualDuty
FLAG 400 1184 Vt
FLAG 1600 1360 0
FLAG 1568 1184 Vcc
FLAG 304 1488 0
SYMBOL ind 2352 896 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 50µ
SYMATTR SpiceLine Rser=0.02 Rpar=5000
SYMBOL schottky 2656 896 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value MBRS340
SYMBOL RES 3120 944 R0
SYMATTR InstName R1
SYMATTR Value 10.7K
SYMBOL RES 3120 1088 R0
SYMATTR InstName R2
SYMATTR Value 1.24K
SYMBOL polcap 3248 896 R0
SYMATTR InstName C1
SYMATTR Value 10µ
SYMATTR SpiceLine Rser=15m
SYMBOL VOLTAGE 2960 2016 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value 12
SYMBOL res 3360 880 R0
SYMATTR InstName Rload
SYMATTR Value 100
SYMBOL res 2608 1440 R0
SYMATTR InstName R4
SYMATTR Value 1m
SYMBOL VOLTAGE 2352 1984 R0
WINDOW 3 -228 -46 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value SINE(.25 .1 50)
SYMATTR InstName V3
SYMBOL schottky 2224 992 R180
WINDOW 0 24 64 Left 2
WINDOW 3 -116 34 Left 2
SYMATTR InstName D2
SYMATTR Value MBRS340
SYMBOL res 1216 864 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 0.1
SYMBOL Opamps\\LT1995 3072 560 R0
SYMATTR InstName U1
SYMBOL Opamps\\LT1995 1280 528 R0
SYMATTR InstName U3
SYMBOL VOLTAGE 2608 2048 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V4
SYMATTR Value 10
SYMBOL VOLTAGE 2608 1872 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V5
SYMATTR Value 15
SYMBOL nmos 2576 1264 R0
SYMATTR InstName M1
SYMATTR Value Si4896DY
SYMBOL res 1456 1264 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 10
SYMBOL res 2864 864 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 0.1
SYMBOL res 1232 960 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL RES 2992 944 R0
SYMATTR InstName R9
SYMATTR Value 3.76K
SYMBOL RES 2992 1088 R0
SYMATTR InstName R10
SYMATTR Value 1.24K
SYMBOL res 2528 1584 R0
WINDOW 0 -42 15 Left 2
WINDOW 3 -46 65 Left 2
SYMATTR InstName R16
SYMATTR Value 10k
SYMBOL Comparators\\LT1671 1184 1312 R0
SYMATTR InstName U4
SYMBOL res 1376 1392 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 2k
SYMBOL nmos 1600 1760 R0
SYMATTR InstName M3
SYMATTR Value 2N7002
SYMBOL Digital\\and 1536 1792 R0
SYMATTR InstName A1
SYMATTR Value2 Vhigh=5 Ref=2.5 td=5ns
SYMBOL res 1408 1888 R0
SYMATTR InstName R15
SYMATTR Value 1k
SYMBOL cap 1408 1856 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 250p
SYMBOL nmos 1264 928 R270
SYMATTR InstName M4
SYMATTR Value Si4896DY
SYMBOL voltage 2816 1872 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value 5
SYMBOL PowerProducts\\LTC7001 1872 1328 R0
SYMATTR InstName U5
SYMBOL cap 2128 1376 R0
SYMATTR InstName C4
SYMATTR Value 0.1µ
SYMBOL diode 1856 1136 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL res -112 1088 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 1Meg
SYMBOL Opamps\\LT6015 -144 1280 R0
SYMATTR InstName U2
SYMBOL schottky -256 1360 R0
SYMATTR InstName D4
SYMATTR Value MBRS340
SYMBOL cap -112 1360 R0
SYMATTR InstName C5
SYMATTR Value 5µ
SYMBOL res -256 1472 R0
SYMATTR InstName R3
SYMATTR Value 100k
SYMBOL res 3504 880 R0
SYMATTR InstName Rload1
SYMATTR Value 100
SYMBOL res 3632 880 R0
SYMATTR InstName Rload2
SYMATTR Value 50
SYMBOL res 3760 880 R0
SYMATTR InstName Rload3
SYMATTR Value 25
SYMBOL res 736 2032 R0
SYMATTR InstName R17
SYMATTR Value 976k
SYMBOL res 736 2144 R0
SYMATTR InstName R18
SYMATTR Value 182k
SYMBOL res 400 2112 R0
SYMATTR InstName R19
SYMATTR Value 62.6k
SYMBOL voltage 880 2032 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V6
SYMATTR Value 5
SYMBOL voltage 2176 2128 R0
SYMATTR InstName V8
SYMATTR Value 1.24
SYMBOL voltage 192 800 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 1
SYMBOL res -352 1824 R0
SYMATTR InstName R21
SYMATTR Value 14.9k
SYMBOL res -352 1968 R0
SYMATTR InstName R22
SYMATTR Value 10k
SYMBOL Digital\\and 1616 1232 R0
SYMATTR InstName A2
SYMATTR Value2 Vhigh=5 Ref=2.5 td=5ns
SYMBOL SpecialFunctions\\LTC6992-3 592 2032 R0
SYMATTR InstName U7
SYMBOL res 2112 1264 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 10
SYMBOL res 2112 1344 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 10
SYMBOL diode 288 1312 R0
SYMATTR InstName D5
SYMATTR Value 1N4148
SYMBOL diode 288 1408 R0
SYMATTR InstName D6
SYMATTR Value 1N4148
SYMBOL cap -64 1088 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 10µ
SYMBOL res -384 1232 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 10
TEXT 2712 1688 Left 2 !.tran 0 15m 0 10n startup
TEXT 2720 1736 Left 2 !.model my_sw sw(Vt= 0.5 Vh=-.25 Ron=0.01 Roff=100Meg)
TEXT 2736 1464 Left 2 ;Usual location for boost sense\nresistor, but since we've got a \nhigh-side sense amplifier, we\nmight as well use it.
TEXT 1536 728 Left 2 ;MUST be shorted\nin BOOST mode,\ncut link in BUCK mode
TEXT 1096 304 Left 2 ;"Poor man's current probe"
TEXT 2880 344 Left 2 ;"Poor man's current probe"
TEXT 2552 792 Left 2 ;(Can be shorted\nin Buck mode)
TEXT 2016 952 Left 2 ;(Can be open\nin Boost mode)
TEXT 608 1608 Left 2 ;MUST Connect for Boost\nalso works for buck
TEXT 616 1456 Left 2 ;Optional for Boost
TEXT 1584 1936 Left 2 ;Positive edge detector - \nSet pulse needs to be a sliver
TEXT 2712 2080 Left 2 ;TGate pulled high\nin boost mode
TEXT 1520 2016 Left 2 ;74HC03 is exactly the right part\n(NAND w/ Open Drain outputs)
TEXT 1120 1152 Left 2 ;Comparator
TEXT 1776 1512 Left 2 ;Gate Driver
TEXT 2248 1848 Left 2 ;Sine stimulus for\nAC analysis
TEXT 1856 1680 Left 2 ;tgate and tsource connected for Buck mode\nbgate and bsource connected for Boost mode
TEXT 2120 2264 Left 2 ;Voltage sources
TEXT 776 744 Left 2 ;Gain of 7 \nProportion of 0.7V =1A
TEXT 2560 656 Left 2 ;Gain of 7 \nProportion of 0.7V =1A
TEXT -872 1680 Left 2 ;feedback voltage for output voltages
TEXT 2056 776 Left 7 ;BUCK
TEXT 448 1840 Left 2 ;fout = (1MHz * 50k) / (N * Rset)\nRset = (1MHz * 50k) / (N * fout)
TEXT 520 2176 Left 2 ;Master Clock
TEXT 320 1768 Left 2 ;duty = Vmod-0.1/0.8
TEXT -344 1792 Left 2 ;Potentiometer
RECTANGLE Normal 3088 2288 2064 1792 2
CIRCLE Normal 592 1600 560 1568
CIRCLE Normal 592 1504 560 1472
CIRCLE Normal 592 1552 560 1520
CIRCLE Normal 2224 1408 2192 1376
CIRCLE Normal 2224 1312 2192 1280
CIRCLE Normal 2224 1360 2192 1328
CIRCLE Normal 2224 1616 2192 1584
CIRCLE Normal 2224 1520 2192 1488
CIRCLE Normal 2224 1568 2192 1536
CIRCLE Normal -336 1712 -368 1680
CIRCLE Normal -336 1616 -368 1584
CIRCLE Normal -336 1664 -368 1632
CIRCLE Normal 368 1200 336 1168
CIRCLE Normal 368 1104 336 1072
CIRCLE Normal 368 1152 336 1120
CIRCLE Normal 224 2016 192 1984
CIRCLE Normal 224 1920 192 1888
CIRCLE Normal 224 1968 192 1936
